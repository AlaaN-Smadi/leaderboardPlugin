<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



  <!-- JS -->
  <script src="../../../scripts/buildfire.js"></script>


    <script src="js/scoreboard.js"></script>
    <script src="../../../scripts/buildfire/services/notifications/pushNotifications.js"></script>


    <script src="js/shared/ui.js"></script>
    <script src="js/listView.js"></script>


    <link rel="stylesheet" href="listView.css">
    <link rel="stylesheet" href="main.css">
</head>
<body>
<span>Score</span><input id="score" type="number" value="100"><button onclick="save()">Set</button>
<div id="listViewContainer">

</div>

<script>

	let lv = new ListView("listViewContainer",{enableAddButton:true,Title:"Leader Board"});
	lv.onAddButtonClicked=()=>{

		let item= new ListViewItem({
			title:"Title 1"
			, description:"Here is my really long description. Here is my really long description. Here is my really long description. "
			,imageUrl:"https://img.icons8.com/officel/2x/worldwide-location.png"

		});

		lv.addItem(item);
	};





	let sb = new buildfire.gamify.Scoreboard("leaders",100,{
		autoSubscribeToPushNotification:true
		,overrideRecords:true
        ,sortAscending:false
	});
    function save(){
		buildfire.auth.getCurrentUser((e,user)=>{
			if(!user)
				buildfire.auth.login();
			else {

				sb.logScore(user, parseInt(score.value),(r,err)=>{
					loadBoard();
                });

			}
        });

    }

    function loadBoard(){
		listViewContainer.innerHTML='';
		let i=0;
		let list=[];
		sb.getScoreboard((err,records)=>{
			records.topScores.forEach(r=>{
				i++;
				let url = buildfire.auth.getUserPictureUrl({userId:r.user.id});
				//url=buildfire.imageLib.cropImage(url,{width:64,height:64});
				list.push({
					title:r.user.displayName
					,imageUrl:url
					,description:r.score
					,toolbar:[{
						key:"btnBadge"
						,class:"toolbarBadge"
						,text:i<4?i:""
					}]
				});
            });

			lv.loadListViewItems(list);

        });
    }
	loadBoard();
</script>
</body>
</html>
